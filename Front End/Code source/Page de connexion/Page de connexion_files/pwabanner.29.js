!function($){$.pwaBanner=function(n,e){var t=this;t.options={};var o={debug:!1,manifestFetch:!1,manifestDefaults:{name:document.title,domain:window.location.hostname,icon:null},manifestIconPointer:0,delay:1e3,modes:{iPhone:!0,nativePrompt:!0},cookieName:"pwabanner",cookieDurationDismiss:30,cookieDurationInstall:90,selectorButtonDismiss:'[data-role="dismiss"]',selectorButtonInstall:'[data-role="install"]',removeBannerOnHashChange:!0,offset:0,tolerance:{up:1e3,down:0},classes:{pinned:"pwabanner-banner--pinned",unpinned:"pwabanner-banner--unpinned"},onBeforeInit:function(n){},onInit:function(n){},onInstall:function(n){},onAvailable:function(n){},onDismiss:function(n){}};t.aborted=!1,t.bannerMode=null,t.bannerStatus="waiting",t.installPromptEvent=null,t.dom={},t.dom.$template=$(n),t.dom.$container=void 0,t.ua=navigator.userAgent,t.userAgent={},t.userAgent.isWebAppiOS=window.navigator.standalone===!0,t.userAgent.isWebAppChrome=window.matchMedia("(display-mode: standalone)").matches,t.userAgent.isWebApp=t.userAgent.isWebAppiOS||t.userAgent.isWebAppChrome,t.transitionEndEvent=function(){var n,e=document.createElement("fakeelement"),t={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(n in t)if(void 0!==e.style[n])return t[n];return!1}(),t.init=function(){u();var n=t.options.onBeforeInit(t);if(n===!1)return!1;var e=m(t.options.cookieName);return!!(t.options.debug||"dismiss"!==e&&"installed"!==e)&&void t.process()},t.process=function(){var n=!1;t.options.modes.iPhone&&/Safari/i.test(t.ua)&&/iPhone/i.test(t.ua)&&/Chrome/i.test(t.ua)===!1&&/CriOS/i.test(t.ua)===!1?(n=!0,t.processSafariIphone(),t.options.onInit(t)):t.options.modes.nativePrompt&&/Chrome/i.test(t.ua)&&/Android/i.test(t.ua)&&(n=!0,t.options.delay=0,t.processNativePrompt(),t.options.onInit(t))},t.processSafariIphone=function(){var n=parseFloat((""+(/CPU.*OS ([0-9_]{1,5})|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))||!1;return t.bannerMode="iOS",t.gaPlatform="iOS "+n+" - iPhone",!(!n||parseFloat(n)<9)&&(!(t.userAgent.isWebApp||n<=12&&p())&&(!$('meta[name="apple-itunes-app"]').length&&(t.bannerStatus="install-available",i(),void t.options.onAvailable(t))))},t.processNativePrompt=function(){var n=function(){var n=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);return!!n&&parseInt(n[2],10)}();return t.bannerMode="nativePrompt",t.gaPlatform="Chrome "+n+" - Android",t.options.debug?!t.userAgent.isWebApp&&(t.bannerStatus="install-available",i(),void t.options.onAvailable(t)):(window.addEventListener("beforeinstallprompt",function(e){return t.userAgent.isWebApp?(e.preventDefault(),!1):(t.bannerStatus="install-available",n&&n<=67?(e.preventDefault(),t.installPromptEvent=e,i()):(e.preventDefault(),t.installPromptEvent=e),void t.options.onAvailable(t))}),void window.addEventListener("appinstalled",function(n){t.bannerStatus="installed",t.options.onInstall(t)}))};var i=function(){var n=function(){l(),t.dom.$container.addClass("pwabanner-initialized"),setTimeout(function(){window.scrollY<=t.options.offset?t.dom.$container.addClass("pwabanner-banner--pinned"):t.dom.$container.addClass("pwabanner-banner--unpinned")},1),"undefined"!=typeof Headroom&&t.dom.$container.headroom({offset:t.options.offset,tolerance:t.options.tolerance,classes:t.options.classes})};setTimeout(function(){return!t.aborted&&void(t.options.manifestFetch?d(function(e,t){n()}):n())},t.options.delay)},a=function(){t.dom.$container.addClass(t.options.classes.unpinned),t.transitionEndEvent?t.dom.$container.one(t.transitionEndEvent,function(n){s()}):s()},s=function(){"undefined"!=typeof Headroom&&t.dom.$container.headroom("destroy"),t.options.removeBannerOnHashChange&&$(window).off("hashchange.pwaBanner"),t.dom.$container.remove()},r=0,l=function(){if(1===r)return!1;var n=t.dom.$template.html();n.indexOf("{{App")>-1&&(n=n.replace("{{AppIcon}}",t.options.manifestDefaults.icon),n=n.replace("{{AppName}}",t.options.manifestDefaults.name),n=n.replace("{{AppDomain}}",t.options.manifestDefaults.domain)),t.dom.$container=$(n),bj.$body.append(t.dom.$container),t.dom.$button_dismiss=t.dom.$container.find(t.options.selectorButtonDismiss),t.dom.$button_install=t.dom.$container.find(t.options.selectorButtonInstall),t.dom.$button_dismiss.on("click",function(n){"installed"!==t.bannerStatus&&(t.bannerStatus="dismiss",c(t.options.cookieName,"dismiss",t.options.cookieDurationDismiss)),a(),t.options.onDismiss(t)}),t.dom.$button_install.on("click",function(n){t.bannerStatus="installed",c(t.options.cookieName,"installed",t.options.cookieDurationInstall),"iOS"===t.bannerMode?(t.dom.$container.attr("data-state","step2"),window.scrollTo(0,0),t.options.onInstall(t)):"nativePrompt"===t.bannerMode&&(a(),t.installPromptEvent&&t.installPromptEvent.prompt())}),t.options.removeBannerOnHashChange&&($(window).off("hashchange.pwaBanner"),$(window).on("hashchange.pwaBanner",function(n){t.aborted=!0,a()})),r=1},d=function(n){$.getJSON(bj.$html.children("head").find('link[rel="manifest"]').attr("href"),function(e){"name"in e&&(t.options.manifestDefaults.name=e.name),"icons"in e&&t.options.manifestIconPointer in e.icons?t.options.manifestDefaults.icon=e.icons[t.options.manifestIconPointer].src:t.options.manifestDefaults.icon="/favicon.ico",$.isFunction(n)&&n(t,e)})},p=function(){var n=!1,e=window.sessionStorage;try{e.setItem("someKeyHere","test"),e.removeItem("someKeyHere")}catch(t){t.code===DOMException.QUOTA_EXCEEDED_ERR&&0===e.length&&(n=!0)}try{window.openDatabase(null,null,null,null)}catch(t){n=!0}return n},u=function(){t.options=$.extend(!0,{},o,e)},c=function(n,e,t){var o=new Date;o.setDate(o.getDate()+t);var i=escape(e)+(null==t?"":"; expires="+o.toUTCString())+"; path=/";document.cookie=n+"="+i},m=function(n){var e=document.cookie,t=e.indexOf(" "+n+"=");if(t==-1&&(t=e.indexOf(n+"=")),t==-1)e=null;else{t=e.indexOf("=",t)+1;var o=e.indexOf(";",t);o==-1&&(o=e.length),e=unescape(e.substring(t,o))}return e};t.init()},$.fn.pwaBanner=function(n){return this.each(function(){if(void 0===$(this).data("pwaBanner")){var e=new $.pwaBanner(this,n);$(this).data("pwaBanner",e)}})}}(jQuery);